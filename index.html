<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top Plombiers Lyon - Comparateur Intelligent</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a365d;
            --primary-light: #2d4a7c;
            --accent: #d4af37;
            --accent-light: #f4d06f;
            --bg: #fafaf9;
            --bg-card: #ffffff;
            --text: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --shadow: rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header avec effet parallaxe */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            padding: 4rem 2rem 6rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.15) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 20s ease-in-out infinite;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -30%;
            left: -5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 15s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }

        .header-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
            animation: fadeInUp 0.8s ease-out;
        }

        .subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
            animation: fadeInUp 0.8s ease-out 0.4s backwards;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
            display: block;
            font-family: 'Crimson Pro', serif;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Container principal */
        .container {
            max-width: 1200px;
            margin: -3rem auto 4rem;
            padding: 0 2rem;
            position: relative;
            z-index: 2;
        }

        /* Filtres */
        .filters {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
            margin-bottom: 3rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        select, input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }

        /* Grille de cartes */
        .plumbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }

        /* Carte plombier */
        .plumber-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 12px var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
            animation: fadeIn 0.5s ease-out backwards;
        }

        .plumber-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px var(--shadow);
            border-color: var(--accent-light);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Badge rang */
        .rank-badge {
            position: absolute;
            top: -12px;
            left: 2rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .featured {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.03) 0%, rgba(212, 175, 55, 0.01) 100%);
        }

        /* En-t√™te de carte */
        .card-header {
            margin-bottom: 1.5rem;
        }

        .plumber-name {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .location::before {
            content: 'üìç';
        }

        /* Scores */
        .scores {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .score-item {
            flex: 1;
            text-align: center;
            padding: 1rem;
            background: var(--bg);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .score-item:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%);
        }

        .score-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
            font-family: 'Crimson Pro', serif;
        }

        .score-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Analyse IA */
        .analysis {
            margin-bottom: 1.5rem;
        }

        .analysis-header {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .summary {
            color: var(--text);
            font-size: 0.95rem;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .strengths {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            padding: 0.4rem 0.8rem;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            color: var(--success);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* Contact */
        .contact {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .contact-btn {
            flex: 1;
            min-width: 140px;
            padding: 0.85rem 1.25rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26, 54, 93, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Loading state */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        .footer {
            background: var(--primary);
            color: white;
            text-align: center;
            padding: 3rem 2rem;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .footer h3 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .footer p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 3rem 1rem 4rem;
            }

            h1 {
                font-size: 2rem;
            }

            .stats {
                gap: 2rem;
            }

            .container {
                padding: 0 1rem;
            }

            .filters {
                padding: 1.5rem;
            }

            .plumbers-grid {
                grid-template-columns: 1fr;
            }

            .scores {
                flex-direction: column;
            }
        }

        /* Animation delays pour effet cascade */
        .plumber-card:nth-child(1) { animation-delay: 0.1s; }
        .plumber-card:nth-child(2) { animation-delay: 0.2s; }
        .plumber-card:nth-child(3) { animation-delay: 0.3s; }
        .plumber-card:nth-child(4) { animation-delay: 0.4s; }
        .plumber-card:nth-child(5) { animation-delay: 0.5s; }
        .plumber-card:nth-child(6) { animation-delay: 0.6s; }
        .plumber-card:nth-child(7) { animation-delay: 0.7s; }
        .plumber-card:nth-child(8) { animation-delay: 0.8s; }
        .plumber-card:nth-child(9) { animation-delay: 0.9s; }
        .plumber-card:nth-child(10) { animation-delay: 1s; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>Top Plombiers Lyon</h1>
            <p class="subtitle">Comparateur intelligent bas√© sur l'analyse IA de milliers d'avis clients</p>
            <div class="stats">
                <div class="stat">
                    <span class="stat-number" id="totalPlumbers">10</span>
                    <span class="stat-label">Plombiers analys√©s</span>
                </div>
                <div class="stat">
                    <span class="stat-number" id="totalReviews">0</span>
                    <span class="stat-label">Avis v√©rifi√©s</span>
                </div>
                <div class="stat">
                    <span class="stat-number">100%</span>
                    <span class="stat-label">Analyse IA</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Container principal -->
    <div class="container">
        <!-- Filtres -->
        <div class="filters">
            <div class="filter-group">
                <label for="quartier">Quartier</label>
                <select id="quartier">
                    <option value="">Tous les quartiers</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="noteMin">Note minimum</label>
                <select id="noteMin">
                    <option value="0">Toutes les notes</option>
                    <option value="4.5">4.5+ ‚≠ê</option>
                    <option value="4.7">4.7+ ‚≠ê‚≠ê</option>
                    <option value="4.9">4.9+ ‚≠ê‚≠ê‚≠ê</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="search">Rechercher</label>
                <input type="text" id="search" placeholder="Nom du plombier...">
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Chargement des meilleurs plombiers de Lyon...</p>
        </div>

        <!-- Grille de plombiers -->
        <div class="plumbers-grid" id="plumbersGrid" style="display: none;"></div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <h3>M√©thodologie</h3>
            <p>Nos scores sont calcul√©s automatiquement par IA en analysant :</p>
            <p>‚úì Les avis Google v√©rifi√©s ‚Ä¢ ‚úì La qualit√© du service ‚Ä¢ ‚úì La r√©activit√© ‚Ä¢ ‚úì Le rapport qualit√©-prix</p>
            <p style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.7;">
                Donn√©es mises √† jour quotidiennement ‚Ä¢ Powered by Claude AI
            </p>
        </div>
    </footer>

    <script>
        // ============================================
        // CONFIGURATION SUPABASE
        // ============================================
        const SUPABASE_URL = 'https://lcbgbrfqokoaiatsqmmh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjYmdicmZxb2tvYWlhdHNxbW1oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NzQyNTUsImV4cCI6MjA4NjM1MDI1NX0.FP5OL_HOzwRUUP2c2bU_BUCk_tWJmpSjB_NcCreQOm0';

        // ============================================
        // DONN√âES DE D√âMONSTRATION (√† remplacer)
        // ============================================
        const DEMO_DATA = [
            {
                id: 1,
                nom: "Accord Artisans Serrurier Lyon",
                ville: "Lyon",
                quartiers: ["Lyon 3e"],
                adresse: "124 Rue du Dauphin√©, 69003 Lyon",
                telephone: "06 10 19 11 91",
                google_url: "https://maps.google.com/?cid=12345",
                note_google: 4.9,
                nb_avis: 1262,
                score_ia: 85,
                featured: true,
                analyse_ia: {
                    resume_neutre: "Artisan serrurier et plombier avec excellente r√©activit√© et transparence tarifaire.",
                    points_forts: [
                        "R√©activit√© exceptionnelle",
                        "Transparence des tarifs",
                        "Professionnalisme reconnu"
                    ]
                }
            },
            {
                id: 2,
                nom: "Plomberie Lyonnaise Premium",
                ville: "Lyon",
                quartiers: ["Lyon 6e", "Lyon 3e"],
                adresse: "45 Cours Vitton, 69006 Lyon",
                telephone: "04 78 52 36 41",
                google_url: "https://maps.google.com/?cid=67890",
                note_google: 4.8,
                nb_avis: 847,
                score_ia: 82,
                featured: true,
                analyse_ia: {
                    resume_neutre: "Entreprise √©tablie avec forte expertise technique et service client de qualit√©.",
                    points_forts: [
                        "Expertise technique solide",
                        "Service client r√©actif",
                        "Devis d√©taill√©s"
                    ]
                }
            },
            {
                id: 3,
                nom: "Rh√¥ne Plomberie Services",
                ville: "Lyon",
                quartiers: ["Lyon 7e", "Lyon 8e"],
                adresse: "28 Avenue Jean Jaur√®s, 69007 Lyon",
                telephone: "04 72 73 15 82",
                google_url: "https://maps.google.com/?cid=11111",
                note_google: 4.7,
                nb_avis: 623,
                score_ia: 79,
                featured: false,
                analyse_ia: {
                    resume_neutre: "Sp√©cialiste en d√©pannage urgence avec bon rapport qualit√©-prix.",
                    points_forts: [
                        "Disponibilit√© 24h/24 et 7j/7",
                        "Tarifs comp√©titifs",
                        "Interventions rapides"
                    ]
                }
            },
            {
                id: 4,
                nom: "AquaFix Lyon",
                ville: "Lyon",
                quartiers: ["Lyon 2e", "Lyon 5e"],
                adresse: "12 Quai Saint-Antoine, 69002 Lyon",
                telephone: "04 78 37 28 94",
                google_url: "https://maps.google.com/?cid=22222",
                note_google: 4.6,
                nb_avis: 534,
                score_ia: 76,
                featured: false,
                analyse_ia: {
                    resume_neutre: "Entreprise familiale reconnue pour son savoir-faire traditionnel.",
                    points_forts: [
                        "Exp√©rience familiale",
                        "Conseils personnalis√©s",
                        "Garantie travaux"
                    ]
                }
            },
            {
                id: 5,
                nom: "Lyon Plomberie Express",
                ville: "Lyon",
                quartiers: ["Lyon 1er", "Lyon 4e"],
                adresse: "67 Rue de la R√©publique, 69001 Lyon",
                telephone: "04 78 28 45 73",
                google_url: "https://maps.google.com/?cid=33333",
                note_google: 4.5,
                nb_avis: 412,
                score_ia: 73,
                featured: false,
                analyse_ia: {
                    resume_neutre: "Service urgence efficace avec √©quipe jeune et dynamique.",
                    points_forts: [
                        "Rapidit√© intervention",
                        "√âquipe sympathique",
                        "Prix justes"
                    ]
                }
            }
        ];

        // ============================================
        // √âTAT DE L'APPLICATION
        // ============================================
        let allPlumbers = [];
        let filteredPlumbers = [];

        // ============================================
        // CHARGEMENT DES DONN√âES
        // ============================================
        async function loadPlumbers() {
            try {
                // Si Supabase est configur√©, utiliser l'API
                if (SUPABASE_URL !== 'VOTRE_URL_SUPABASE') {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/plombiers?order=score_ia.desc&limit=10`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    });
                    
                    if (response.ok) {
                        allPlumbers = await response.json();
                    } else {
                        throw new Error('Erreur Supabase');
                    }
                } else {
                    // Sinon, utiliser les donn√©es de d√©mo
                    allPlumbers = DEMO_DATA;
                }

                filteredPlumbers = [...allPlumbers];
                updateStats();
                populateFilters();
                renderPlumbers();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('plumbersGrid').style.display = 'grid';
            } catch (error) {
                console.error('Erreur:', error);
                // En cas d'erreur, utiliser les donn√©es de d√©mo
                allPlumbers = DEMO_DATA;
                filteredPlumbers = [...allPlumbers];
                updateStats();
                populateFilters();
                renderPlumbers();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('plumbersGrid').style.display = 'grid';
            }
        }

        // ============================================
        // MISE √Ä JOUR DES STATISTIQUES
        // ============================================
        function updateStats() {
            const totalReviews = allPlumbers.reduce((sum, p) => sum + p.nb_avis, 0);
            document.getElementById('totalPlumbers').textContent = allPlumbers.length;
            document.getElementById('totalReviews').textContent = totalReviews.toLocaleString('fr-FR');
        }

        // ============================================
        // REMPLISSAGE DES FILTRES
        // ============================================
        function populateFilters() {
            const quartiers = new Set();
            allPlumbers.forEach(p => {
                if (p.quartiers && Array.isArray(p.quartiers)) {
                    p.quartiers.forEach(q => quartiers.add(q));
                }
            });

            const quartierSelect = document.getElementById('quartier');
            quartiers.forEach(q => {
                const option = document.createElement('option');
                option.value = q;
                option.textContent = q;
                quartierSelect.appendChild(option);
            });
        }

        // ============================================
        // FILTRAGE
        // ============================================
        function applyFilters() {
            const quartier = document.getElementById('quartier').value;
            const noteMin = parseFloat(document.getElementById('noteMin').value);
            const search = document.getElementById('search').value.toLowerCase();

            filteredPlumbers = allPlumbers.filter(p => {
                const matchQuartier = !quartier || (p.quartiers && p.quartiers.includes(quartier));
                const matchNote = p.note_google >= noteMin;
                const matchSearch = !search || p.nom.toLowerCase().includes(search);
                
                return matchQuartier && matchNote && matchSearch;
            });

            renderPlumbers();
        }

        // ============================================
        // AFFICHAGE DES PLOMBIERS
        // ============================================
        function renderPlumbers() {
            const grid = document.getElementById('plumbersGrid');
            grid.innerHTML = '';

            if (filteredPlumbers.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-muted);">Aucun plombier ne correspond √† vos crit√®res.</p>';
                return;
            }

            filteredPlumbers.forEach((plumber, index) => {
                const card = createPlumberCard(plumber, index + 1);
                grid.appendChild(card);
            });
        }

        // ============================================
        // CR√âATION D'UNE CARTE
        // ============================================
        function createPlumberCard(plumber, rank) {
            const card = document.createElement('div');
            card.className = `plumber-card ${plumber.featured ? 'featured' : ''}`;

            const quartiers = plumber.quartiers && plumber.quartiers.length > 0 
                ? plumber.quartiers.join(', ') 
                : plumber.ville;

            const pointsForts = plumber.analyse_ia?.points_forts || [];
            const resume = plumber.analyse_ia?.resume_neutre || 'Analyse en cours...';

            card.innerHTML = `
                <div class="rank-badge">#${rank}</div>
                
                <div class="card-header">
                    <h2 class="plumber-name">${plumber.nom}</h2>
                    <div class="location">${quartiers}</div>
                </div>

                <div class="scores">
                    <div class="score-item">
                        <span class="score-value">${plumber.score_ia}</span>
                        <span class="score-label">Score IA</span>
                    </div>
                    <div class="score-item">
                        <span class="score-value">${plumber.note_google}</span>
                        <span class="score-label">Note Google</span>
                    </div>
                    <div class="score-item">
                        <span class="score-value">${plumber.nb_avis}</span>
                        <span class="score-label">Avis</span>
                    </div>
                </div>

                <div class="analysis">
                    <div class="analysis-header">ü§ñ Analyse IA</div>
                    <p class="summary">${resume}</p>
                    <div class="strengths">
                        ${pointsForts.slice(0, 3).map(point => `
                            <span class="tag">‚úì ${point}</span>
                        `).join('')}
                    </div>
                </div>

                <div class="contact">
                    <a href="tel:${plumber.telephone}" class="contact-btn btn-primary" onclick="trackClick(${plumber.id}, 'phone')">
                        üìû Appeler
                    </a>
                    <a href="${plumber.google_url}" target="_blank" class="contact-btn btn-secondary" onclick="trackClick(${plumber.id}, 'maps')">
                        üó∫Ô∏è Voir sur Maps
                    </a>
                </div>
            `;

            return card;
        }

        // ============================================
        // TRACKING DES CLICS (optionnel)
        // ============================================
        function trackClick(plumberId, type) {
            console.log(`Clic ${type} sur plombier ${plumberId}`);
            // Ici tu peux ajouter un appel API pour tracker les clics dans Supabase
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.getElementById('quartier').addEventListener('change', applyFilters);
        document.getElementById('noteMin').addEventListener('change', applyFilters);
        document.getElementById('search').addEventListener('input', applyFilters);

        // ============================================
        // INITIALISATION
        // ============================================
        loadPlumbers();
    </script>
</body>
</html>
